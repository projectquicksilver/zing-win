<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Lucky Slots ‚Äî Card Two</title>
  <link rel="stylesheet" href="../shared/shared.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    /* ‚îÄ‚îÄ SLOT MACHINE ‚îÄ‚îÄ */
    .machine {
      background: linear-gradient(148deg, #1a1438, #110f30, #191535);
      border: 1.5px solid rgba(255,215,0,0.2);
      border-radius: 32px;
      padding: 28px 36px 26px;
      box-shadow: 0 0 70px rgba(255,45,107,0.1), 0 0 130px rgba(255,215,0,0.06), var(--shadow2), inset 0 1px 0 rgba(255,255,255,0.06);
      display: flex; flex-direction: column; align-items: center; gap: 16px;
      position: relative; opacity: 0;
    }

    /* Bolt rivets */
    .bolt { position: absolute; width: 13px; height: 13px; border-radius: 50%;
      background: radial-gradient(circle at 40% 35%, #555, #1a1a1a);
      border: 1px solid rgba(255,255,255,0.08); }
    .bolt.tl{top:16px;left:16px} .bolt.tr{top:16px;right:16px}
    .bolt.bl{bottom:16px;left:16px} .bolt.br{bottom:16px;right:16px}

    /* Neon sign */
    .machine-neon {
      font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 8px;
      background: linear-gradient(90deg, var(--gold), var(--amber), var(--rose));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 10px rgba(255,150,0,0.55));
      animation: neonFlicker 4s ease-in-out infinite;
    }
    @keyframes neonFlicker {
      0%,97%,100% { filter: drop-shadow(0 0 10px rgba(255,150,0,0.55)); }
      98% { filter: drop-shadow(0 0 3px rgba(255,150,0,0.2)); opacity: 0.8; }
      99% { filter: drop-shadow(0 0 12px rgba(255,150,0,0.7)); }
    }

    /* Result display */
    .result-bar {
      background: rgba(0,0,0,0.4); border: 1px solid rgba(255,215,0,0.14); border-radius: 12px;
      padding: 8px 24px; display: flex; align-items: center; gap: 12px;
      font-family: 'Orbitron', sans-serif; font-size: 9px; letter-spacing: 4px; color: rgba(255,215,0,0.4);
    }
    .result-txt {
      font-size: 14px; font-weight: 900; color: var(--gold); letter-spacing: 2px;
      min-width: 140px; text-align: center; transition: color 0.3s;
    }

    /* Reel housing */
    .reel-housing {
      background: rgba(0,0,0,0.5); border: 2px solid rgba(255,215,0,0.16);
      border-radius: 18px; padding: 7px 10px;
      display: flex; gap: 9px; position: relative; overflow: hidden;
      box-shadow: inset 0 8px 24px rgba(0,0,0,0.5), inset 0 -4px 12px rgba(0,0,0,0.3);
    }
    /* Window mask */
    .reel-housing::after {
      content:''; position:absolute; inset:0; border-radius:16px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.65) 0%, transparent 22%, transparent 78%, rgba(0,0,0,0.65) 100%);
      pointer-events:none; z-index:8;
    }
    /* Center highlight */
    .reel-housing::before {
      content:''; position:absolute; left:0; right:0; top:50%; transform:translateY(-50%);
      height:72px; z-index:6; pointer-events:none;
      border-top: 1px solid rgba(255,215,0,0.2); border-bottom: 1px solid rgba(255,215,0,0.2);
      background: rgba(255,215,0,0.025);
    }

    .reel { width: 72px; height: 216px; overflow: hidden; border-radius: 12px; background: rgba(0,0,0,0.25); }
    .reel-inner { display: flex; flex-direction: column; will-change: transform; }
    .reel-cell {
      width: 72px; height: 72px; display: flex; align-items: center; justify-content: center;
      font-size: 36px; flex-shrink: 0;
    }

    /* Jackpot glow */
    .jackpot-glow {
      position: absolute; inset: 0; border-radius: 30px;
      box-shadow: none; transition: box-shadow 0.4s;
      pointer-events: none; z-index: -1;
    }
    .jackpot-glow.show {
      box-shadow: 0 0 40px rgba(255,215,0,0.5), 0 0 80px rgba(255,215,0,0.25), inset 0 0 40px rgba(255,215,0,0.1);
      animation: jackpotPulse 0.5s ease-in-out infinite alternate;
    }
    @keyframes jackpotPulse { to { box-shadow: 0 0 70px rgba(255,215,0,0.7), 0 0 140px rgba(255,215,0,0.35), inset 0 0 60px rgba(255,215,0,0.18); } }

    /* Lever */
    .lever {
      position: absolute; right: -54px; top: 50%; transform: translateY(-50%);
      display: flex; flex-direction: column; align-items: center; cursor: none;
    }
    .lever-ball {
      width: 34px; height: 34px; border-radius: 50%;
      background: radial-gradient(circle at 40% 35%, var(--rose), #a00030);
      box-shadow: 0 0 14px rgba(255,45,107,0.6); margin-bottom: -4px; z-index: 2;
    }
    .lever-rod {
      width: 10px; height: 115px;
      background: linear-gradient(to right, #888, #ccc 40%, #888);
      border-radius: 5px; transform-origin: bottom center;
      transition: transform 0.2s cubic-bezier(0.36,0.07,0.19,0.97);
    }
    .lever-base {
      width: 32px; height: 12px; background: linear-gradient(to bottom, #666, #333); border-radius: 6px;
    }
    .lever-hint { font-family:'Orbitron',sans-serif; font-size:6.5px; letter-spacing:3px; color:rgba(255,215,0,0.3); margin-top:5px; text-transform:uppercase; }

    /* Pull button */
    .btn-pull {
      font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 900;
      letter-spacing: 3px; padding: 15px 50px; border-radius: 14px; border: none; cursor: none;
      background: linear-gradient(135deg, var(--rose), #cc1455, var(--violet));
      color: #fff;
      box-shadow: 0 0 30px rgba(255,45,107,0.38), 0 4px 20px rgba(0,0,0,0.45);
      position: relative; overflow: hidden; transition: transform 0.2s;
      opacity: 0;
    }
    .btn-pull::before { content:''; position:absolute; top:-50%; left:-80%; width:55%; height:200%; background:rgba(255,255,255,0.22); transform:skewX(-22deg); animation:btnShine 3s infinite; }
    .btn-pull:hover { transform: scale(1.06); }
    .btn-pull:disabled { opacity: 0.35; }
    .btn-pull.show { opacity: 1; }
  </style>
</head>
<body>
<div id="cursor"></div><div id="cursor-dot"></div>
<canvas id="bgCanvas"></canvas>
<div class="noise"></div><div class="vignette"></div>

<header class="page-header">
  <a href="../index.html" class="back-btn">‚Üê Back to Cards</a>
  <span class="page-badge">Card Two ¬∑ Lucky Slots</span>
</header>

<div id="scene">
  <div class="game-eyebrow">‚ú¶ Three of a kind wins everything ‚ú¶</div>
  <div class="game-title">LUCKY SLOTS</div>

  <div class="machine" id="machine">
    <div class="bolt tl"></div><div class="bolt tr"></div>
    <div class="bolt bl"></div><div class="bolt br"></div>
    <div class="jackpot-glow" id="jackpotGlow"></div>
    <div class="machine-neon">‚òÖ JACKPOT ‚òÖ</div>

    <div class="result-bar">
      <span>RESULT</span>
      <span class="result-txt" id="resultTxt">‚Äì ‚Äì ‚Äì</span>
    </div>

    <div class="reel-housing">
      <div class="reel"><div class="reel-inner" id="r0"></div></div>
      <div class="reel"><div class="reel-inner" id="r1"></div></div>
      <div class="reel"><div class="reel-inner" id="r2"></div></div>
    </div>

    <div class="lever" id="lever">
      <div class="lever-ball"></div>
      <div class="lever-rod" id="leverRod"></div>
      <div class="lever-base"></div>
      <div class="lever-hint">PULL</div>
    </div>
  </div>

  <button class="btn-pull show" id="pullBtn">üé∞ PULL LEVER</button>
</div>

<div class="result-flash" id="resultFlash">
  <div class="rf-badge">Card Two ¬∑ Lucky Slots</div>
  <div class="rf-icon">üé∞</div>
  <div class="rf-title">JACKPOT!</div>
  <div class="rf-sub">The reels have aligned ‚Äî fortune is yours!</div>
  <div class="rf-btns">
    <button class="rf-reveal" id="revealBtn">üèÜ View All Winners</button>
    <button class="btn-secondary" onclick="resetSlots()">‚Üê Play Again</button>
  </div>
</div>

<div id="carousel">
  <div class="car-header">
    <div class="car-title">üèÜ Lucky Draw Winners</div>
    <div class="car-sub">Official Results ¬∑ Coromandel CPC 2025</div>
  </div>
  <div class="car-progress"><div class="car-progress-bar" id="carBar"></div></div>
  <div class="car-viewport"><div class="car-track" id="carTrack"></div></div>
  <div class="car-nav">
    <div class="car-arrow" id="carPrev">‚Üê</div>
    <div class="car-dots" id="carDots"></div>
    <div class="car-arrow" id="carNext">‚Üí</div>
  </div>
  <a href="../index.html" class="car-home">‚Üê Return to Card Select</a>
</div>

<script src="../shared/shared.js"></script>
<script>
  APP.CFG.csvPath = '../data.csv';
  APP.initParticles('bgCanvas');
  APP.initCursor();

  const SYMS = ['üçÄ','‚≠ê','üíé','üîî','üèÜ','üéØ','üçí','‚ö°','üåü','üî•'];
  let spinning = false;

  // Build reels
  for (let r = 0; r < 3; r++) {
    const inner = document.getElementById('r' + r);
    for (let s = 0; s < 28; s++) {
      const cell = document.createElement('div');
      cell.className = 'reel-cell';
      cell.textContent = SYMS[Math.floor(Math.random() * SYMS.length)];
      inner.appendChild(cell);
    }
  }

  // Lever animation
  function animLever(cb) {
    const rod = document.getElementById('leverRod');
    gsap.to(rod, { rotation: 38, duration: 0.18, ease:'power2.in',
      onComplete: () => gsap.to(rod, { rotation: -8, duration: 0.14, ease:'power2.in',
        onComplete: () => { if (cb) cb(); gsap.to(rod, { rotation: 0, duration: 0.25, ease:'elastic.out(1.2,0.5)' }); }
      })
    });
  }

  function spinReel(idx, delay) {
    return new Promise(resolve => {
      setTimeout(() => {
        const inner = document.getElementById('r' + idx);
        const cells = inner.children;
        const total = cells.length * 72;
        const dist = total * 2.5 + Math.random() * total;
        const dur = 1300 + idx * 420;
        let s = null, cur = 0;

        function ease(t) { return 1 - Math.pow(1 - t, 3.5); }
        function raf(ts) {
          if (!s) s = ts;
          const p = Math.min((ts - s) / dur, 1);
          cur = -(dist * ease(p)) % total;
          inner.style.transform = `translateY(${cur}px)`;
          if (p < 1) { requestAnimationFrame(raf); return; }
          const snapIdx = Math.abs(Math.round(cur / 72)) % cells.length;
          inner.style.transform = `translateY(${-snapIdx * 72 + 72}px)`;
          resolve(cells[(snapIdx + 1) % cells.length].textContent);
        }
        requestAnimationFrame(raf);
      }, delay);
    });
  }

  function pull() {
    if (spinning) return;
    spinning = true;
    const btn = document.getElementById('pullBtn');
    btn.disabled = true;
    document.getElementById('jackpotGlow').classList.remove('show');
    animLever(() => {
      Promise.all([spinReel(0,0), spinReel(1,340), spinReel(2,680)]).then(results => {
        const isJack = results.every(v => v === results[0]);
        document.getElementById('resultTxt').textContent = results.join(' ');
        document.getElementById('resultTxt').style.color = isJack ? 'var(--gold)' : 'rgba(255,255,255,0.7)';
        if (isJack) document.getElementById('jackpotGlow').classList.add('show');
        setTimeout(() => {
          document.getElementById('resultFlash').classList.add('show');
          APP.boom(isJack ? '#FFD700' : '#FF2D6B');
          APP.sparks(isJack ? '#FFD700' : '#FF2D6B');
        }, 420);
        spinning = false; btn.disabled = false;
      });
    });
  }

  function resetSlots() {
    document.getElementById('resultFlash').classList.remove('show');
    document.getElementById('jackpotGlow').classList.remove('show');
    document.getElementById('resultTxt').textContent = '‚Äì ‚Äì ‚Äì';
  }

  document.getElementById('pullBtn').addEventListener('click', pull);
  document.getElementById('lever').addEventListener('click', () => { if (!spinning) pull(); });
  document.getElementById('revealBtn').addEventListener('click', () => {
    document.getElementById('resultFlash').classList.remove('show');
    APP.loadCSV(data => {
      document.getElementById('carousel').classList.add('show');
      APP.Carousel.init('carousel', data); APP.boom('#FFD700');
      document.getElementById('carPrev').addEventListener('click', () => APP.Carousel.prev());
      document.getElementById('carNext').addEventListener('click', () => APP.Carousel.next());
    });
  });

  window.addEventListener('load', () => {
    gsap.to('.game-eyebrow', {opacity:1,duration:0.8,delay:0.3});
    gsap.fromTo('.game-title', {opacity:0,y:-22}, {opacity:1,y:0,duration:0.9,ease:'power3.out',delay:0.4});
    gsap.to('#machine', {opacity:1,scale:1,duration:1.1,ease:'back.out(1.4)',delay:0.5});
    gsap.from('#machine', {scale:0.78,y:28});
    gsap.to('.btn-pull', {opacity:1,duration:0.7,delay:0.95});
  });
</script>
</body>
</html>
